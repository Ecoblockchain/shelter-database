<!DOCTYPE html>
<html lang="nl">
{% extends "layout.html" %}
{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename = 'lib/dc/d3.js') }}"></script>
	<script src="{{ url_for('static', filename = 'lib/leaflet/leaflet.js') }}"></script>
	<link href="{{ url_for('static', filename='lib/leaflet/leaflet.css') }}" rel="stylesheet" media="screen" />
{% endblock %}

{% block content %}
        <section class="shelterheader">
            <div class="content">
                <h1>Cordaid, TS Urban</h1>
            </div>
        </section>
        <section class="shelterimg" style="background-image: url('{{ url_for('static', filename = 'img/shelter.jpg') }}')">
            <div class="dots">
                <div class="dot selected"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </section>
        <section class="details">
		    <div class="content">
                <table id="identification"></table>
            </div>
        </section>
		<section class="details details-1">
            <div class="content">
                <h3>General</h3>
                <table id="general"></table>
            </div>
        </section>
        <section>
            <div class="details">
			    <div id="location-map" style="width:100%; height:400px;"></div>
            </div>
        </section>
        <section class="details details-2">
            <div class="content">
                <h3>Disaster & Response</h3>
                <table id="disasterresponse"></table>
            </div>
        </section>

        <section class="details details-1">
            <div class="content">
                <h3>Site</h3>
                <table id="site"></table>
            </div>
        </section>
		
		 <section class="details details-2">
            <div class="content">
                <h3>Foundation</h3>
                <table id="foundation"></table>
            </div>
        </section>
		
		<section class="shelterimg" style="background-image: url('{{ url_for('static', filename = 'img/shelter.jpg') }}')">
            <div class="dots">
                <div class="dot selected"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </section>
		
<script type="text/javascript" class="source">
$(document).ready(function() {
    $( ".attribute-multimedia-asset" ).click(show_multimedia_assets);
});

var shelter_id = {{shelter_id}};

d3.json('/api/v0.2/shelters/' + shelter_id + '?format=prettytext', function (error, data) {
  
	// render the table(s)
	var site = data[shelter_id]['Site']['Attributes'];
	tabulate("#site", site, d3.keys(site));
	
	var general = data[shelter_id]['General']['Attributes'];
	tabulate("#general", general, d3.keys(general));
	
	var disasterresponse = data[shelter_id]['Disaster & Response']['Attributes'];
	tabulate("#disasterresponse", disasterresponse, d3.keys(disasterresponse));
	
	var foundation = data[shelter_id]['Foundation']['Attributes'];
	tabulate("#foundation", foundation, d3.keys(general));
	
	// Get coordinates for this shelter
	var lat = data[shelter_id]['Identification']['Attributes']['GPS Latitude'];
	var lon = data[shelter_id]['Identification']['Attributes']['GPS Longitude'];
	
	// Initiate leaflet map
	var map = L.map('location-map').setView([lat, lon], 13);
	L.marker([lat, lon]).addTo(map);
});

function tabulate(table_id, d, columns) {

	// convert object keys to an attribute value pair
	var data = Object.keys(d).map(function(k) { return {attribute:k, value:d[k]} })
	
	var table = d3.select(table_id)
	var	tbody = table.append('tbody');

	// create a row for each object in the data
	var rows = tbody.selectAll('tr')
	  .data(data)
	  .enter()
	  .append('tr');

	// Add column with attribute names
	rows.append('th')
	  .text(function (d) { return d.attribute; });
	 
	// Add column with values
	rows.append('td')
	  .text(function (d) { return d.value; });
}
</script>
{% endblock %}